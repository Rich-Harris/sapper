{"version":3,"file":"middleware.ts.js","sources":["../src/middleware/mime.ts","../src/middleware.ts"],"sourcesContent":["import mime_raw from './mime-types.md';\n\nconst map: Map<string, string> = new Map();\n\nmime_raw.split('\\n').forEach((row: string) => {\n\tconst match = /(.+?)\\t+(.+)/.exec(row);\n\tif (!match) return;\n\n\tconst type = match[1];\n\tconst extensions = match[2].split(' ');\n\n\textensions.forEach(ext => {\n\t\tmap.set(ext, type);\n\t});\n});\n\nexport function lookup(file: string) {\n\tconst match = /\\.([^\\.]+)$/.exec(file);\n\treturn match && map.get(match[1]);\n}","import * as fs from 'fs';\nimport * as path from 'path';\nimport { resolve, URL } from 'url';\nimport { ClientRequest, ServerResponse } from 'http';\nimport cookie from 'cookie';\nimport mkdirp from 'mkdirp';\nimport rimraf from 'rimraf';\nimport devalue from 'devalue';\nimport fetch from 'node-fetch';\nimport { lookup } from './middleware/mime';\nimport { locations, dev } from './config';\nimport { Route, Template } from './interfaces';\nimport sourceMapSupport from 'source-map-support';\n\nsourceMapSupport.install();\n\ntype RouteObject = {\n\tid: string;\n\ttype: 'page' | 'route';\n\tpattern: RegExp;\n\tparams: (match: RegExpMatchArray) => Record<string, string>;\n\tmodule: Component;\n\terror?: string;\n}\n\ntype Handler = (req: Req, res: ServerResponse, next: () => void) => void;\n\ntype Store = {\n\tget: () => any\n};\n\ninterface Req extends ClientRequest {\n\turl: string;\n\tbaseUrl: string;\n\toriginalUrl: string;\n\tmethod: string;\n\tpath: string;\n\tparams: Record<string, string>;\n\theaders: Record<string, string>;\n}\n\ninterface Component {\n\trender: (data: any, opts: { store: Store }) => {\n\t\thead: string;\n\t\tcss: { code: string, map: any };\n\t\thtml: string\n\t},\n\tpreload: (data: any) => any | Promise<any>\n}\n\nexport default function middleware({ App, routes, store }: {\n\tApp: Component,\n\troutes: RouteObject[],\n\tstore: (req: Req) => Store\n}) {\n\tif (!App) {\n\t\tthrow new Error(`As of 0.12, you must supply an App component to Sapper â€” see https://sapper.svelte.technology/guide#0-11-to-0-12 for more information`);\n\t}\n\n\tconst output = locations.dest();\n\n\tconst client_assets = JSON.parse(fs.readFileSync(path.join(output, 'client_assets.json'), 'utf-8'));\n\n\tconst middleware = compose_handlers([\n\t\t(req: Req, res: ServerResponse, next: () => void) => {\n\t\t\tif (req.baseUrl === undefined) {\n\t\t\t\treq.baseUrl = req.originalUrl\n\t\t\t\t\t? req.originalUrl.slice(0, -req.url.length)\n\t\t\t\t\t: '';\n\t\t\t}\n\n\t\t\tif (req.path === undefined) {\n\t\t\t\treq.path = req.url.replace(/\\?.*/, '');\n\t\t\t}\n\n\t\t\tnext();\n\t\t},\n\n\t\tfs.existsSync(path.join(output, 'index.html')) && serve({\n\t\t\tpathname: '/index.html',\n\t\t\tcache_control: 'max-age=600'\n\t\t}),\n\n\t\tfs.existsSync(path.join(output, 'service-worker.js')) && serve({\n\t\t\tpathname: '/service-worker.js',\n\t\t\tcache_control: 'max-age=600'\n\t\t}),\n\n\t\tfs.existsSync(path.join(output, 'service-worker.js.map')) && serve({\n\t\t\tpathname: '/service-worker.js.map',\n\t\t\tcache_control: 'max-age=600'\n\t\t}),\n\n\t\tserve({\n\t\t\tprefix: '/client/',\n\t\t\tcache_control: 'max-age=31536000'\n\t\t}),\n\n\t\tget_route_handler(client_assets, App, routes, store)\n\t].filter(Boolean));\n\n\treturn middleware;\n}\n\nfunction serve({ prefix, pathname, cache_control }: {\n\tprefix?: string,\n\tpathname?: string,\n\tcache_control: string\n}) {\n\tconst filter = pathname\n\t\t? (req: Req) => req.path === pathname\n\t\t: (req: Req) => req.path.startsWith(prefix);\n\n\tconst output = locations.dest();\n\n\tconst cache: Map<string, Buffer> = new Map();\n\n\tconst read = dev()\n\t\t? (file: string) => fs.readFileSync(path.resolve(output, file))\n\t\t: (file: string) => (cache.has(file) ? cache : cache.set(file, fs.readFileSync(path.resolve(output, file)))).get(file)\n\n\treturn (req: Req, res: ServerResponse, next: () => void) => {\n\t\tif (filter(req)) {\n\t\t\tconst type = lookup(req.path);\n\n\t\t\ttry {\n\t\t\t\tconst data = read(req.path.slice(1));\n\n\t\t\t\tres.setHeader('Content-Type', type);\n\t\t\t\tres.setHeader('Cache-Control', cache_control);\n\t\t\t\tres.end(data);\n\t\t\t} catch (err) {\n\t\t\t\tres.statusCode = 404;\n\t\t\t\tres.end('not found');\n\t\t\t}\n\t\t} else {\n\t\t\tnext();\n\t\t}\n\t};\n}\n\nconst resolved = Promise.resolve();\n\nfunction get_route_handler(chunks: Record<string, string>, App: Component, routes: RouteObject[], store_getter: (req: Req) => Store) {\n\tconst template = dev()\n\t\t? () => fs.readFileSync(`${locations.app()}/template.html`, 'utf-8')\n\t\t: (str => () => str)(fs.readFileSync(`${locations.dest()}/template.html`, 'utf-8'));\n\n\tfunction handle_route(route: RouteObject, req: Req, res: ServerResponse) {\n\t\treq.params = route.params(route.pattern.exec(req.path));\n\n\t\tconst handlers = route.handlers[Symbol.iterator]();\n\n\t\tfunction next() {\n\t\t\ttry {\n\t\t\t\tconst { value: handler, done } = handlers.next();\n\n\t\t\t\tif (done) {\n\t\t\t\t\thandle_error(req, res, 404, 'Not found');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst mod = handler.module;\n\n\t\t\t\tif (handler.type === 'page') {\n\t\t\t\t\tres.setHeader('Content-Type', 'text/html');\n\n\t\t\t\t\t// preload main.js and current route\n\t\t\t\t\t// TODO detect other stuff we can preload? images, CSS, fonts?\n\t\t\t\t\tconst link = []\n\t\t\t\t\t\t.concat(chunks.main, chunks[route.id])\n\t\t\t\t\t\t.filter(file => !file.match(/\\.map$/))\n\t\t\t\t\t\t.map(file => `<${req.baseUrl}/client/${file}>;rel=\"preload\";as=\"script\"`)\n\t\t\t\t\t\t.join(', ');\n\n\t\t\t\t\tres.setHeader('Link', link);\n\n\t\t\t\t\tconst store = store_getter ? store_getter(req) : null;\n\t\t\t\t\tconst props = { params: req.params, query: req.query, path: req.path };\n\n\t\t\t\t\tlet redirect: { statusCode: number, location: string };\n\t\t\t\t\tlet error: { statusCode: number, message: Error | string };\n\n\t\t\t\t\tPromise.resolve(\n\t\t\t\t\t\tmod.preload ? mod.preload.call({\n\t\t\t\t\t\t\tredirect: (statusCode: number, location: string) => {\n\t\t\t\t\t\t\t\tredirect = { statusCode, location };\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\terror: (statusCode: number, message: Error | string) => {\n\t\t\t\t\t\t\t\terror = { statusCode, message };\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfetch: (url: string, opts?: any) => {\n\t\t\t\t\t\t\t\tconst parsed = new URL(url, `http://127.0.0.1:${process.env.PORT}${req.baseUrl ? req.baseUrl + '/'  :''}`);\n\n\t\t\t\t\t\t\t\tif (opts) {\n\t\t\t\t\t\t\t\t\topts = Object.assign({}, opts);\n\n\t\t\t\t\t\t\t\t\tconst include_cookies = (\n\t\t\t\t\t\t\t\t\t\topts.credentials === 'include' ||\n\t\t\t\t\t\t\t\t\t\topts.credentials === 'same-origin' && parsed.origin === `http://127.0.0.1:${process.env.PORT}`\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\tif (include_cookies) {\n\t\t\t\t\t\t\t\t\t\tconst cookies: Record<string, string> = {};\n\t\t\t\t\t\t\t\t\t\tif (!opts.headers) opts.headers = {};\n\n\t\t\t\t\t\t\t\t\t\tconst str = []\n\t\t\t\t\t\t\t\t\t\t\t.concat(\n\t\t\t\t\t\t\t\t\t\t\t\tcookie.parse(req.headers.cookie || ''),\n\t\t\t\t\t\t\t\t\t\t\t\tcookie.parse(opts.headers.cookie || ''),\n\t\t\t\t\t\t\t\t\t\t\t\tcookie.parse(res.getHeader('Set-Cookie') || '')\n\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t.map(cookie => {\n\t\t\t\t\t\t\t\t\t\t\t\treturn Object.keys(cookie)\n\t\t\t\t\t\t\t\t\t\t\t\t\t.map(name => `${name}=${encodeURIComponent(cookie[name])}`)\n\t\t\t\t\t\t\t\t\t\t\t\t\t.join('; ');\n\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t.filter(Boolean)\n\t\t\t\t\t\t\t\t\t\t\t.join(', ');\n\n\t\t\t\t\t\t\t\t\t\topts.headers.cookie = str;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn fetch(parsed.href, opts);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\tstore\n\t\t\t\t\t\t}, req) : {}\n\t\t\t\t\t).catch(err => {\n\t\t\t\t\t\terror = { statusCode: 500, message: err };\n\t\t\t\t\t}).then(preloaded => {\n\t\t\t\t\t\tif (redirect) {\n\t\t\t\t\t\t\tres.statusCode = redirect.statusCode;\n\t\t\t\t\t\t\tres.setHeader('Location', `${req.baseUrl}/${redirect.location}`);\n\t\t\t\t\t\t\tres.end();\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\thandle_error(req, res, error.statusCode, error.message);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst serialized = {\n\t\t\t\t\t\t\tpreloaded: mod.preload && try_serialize(preloaded),\n\t\t\t\t\t\t\tstore: store && try_serialize(store.get())\n\t\t\t\t\t\t};\n\t\t\t\t\t\tObject.assign(props, preloaded);\n\n\t\t\t\t\t\tconst { html, head, css } = App.render({ Page: mod, props }, {\n\t\t\t\t\t\t\tstore\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tlet scripts = []\n\t\t\t\t\t\t\t.concat(chunks.main) // chunks main might be an array. it might not! thanks, webpack\n\t\t\t\t\t\t\t.filter(file => !file.match(/\\.map$/))\n\t\t\t\t\t\t\t.map(file => `<script src='${req.baseUrl}/client/${file}'></script>`)\n\t\t\t\t\t\t\t.join('');\n\n\t\t\t\t\t\tlet inline_script = `__SAPPER__={${[\n\t\t\t\t\t\t\t`baseUrl: \"${req.baseUrl}\"`,\n\t\t\t\t\t\t\tserialized.preloaded && `preloaded: ${serialized.preloaded}`,\n\t\t\t\t\t\t\tserialized.store && `store: ${serialized.store}`\n\t\t\t\t\t\t].filter(Boolean).join(',')}};`;\n\n\t\t\t\t\t\tconst has_service_worker = fs.existsSync(path.join(locations.dest(), 'service-worker.js'));\n\t\t\t\t\t\tif (has_service_worker) {\n\t\t\t\t\t\t\tinline_script += `if ('serviceWorker' in navigator) navigator.serviceWorker.register('${req.baseUrl}/service-worker.js');`;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst page = template()\n\t\t\t\t\t\t\t.replace('%sapper.base%', `<base href=\"${req.baseUrl}/\">`)\n\t\t\t\t\t\t\t.replace('%sapper.scripts%', `<script>${inline_script}</script>${scripts}`)\n\t\t\t\t\t\t\t.replace('%sapper.html%', html)\n\t\t\t\t\t\t\t.replace('%sapper.head%', `<noscript id='sapper-head-start'></noscript>${head}<noscript id='sapper-head-end'></noscript>`)\n\t\t\t\t\t\t\t.replace('%sapper.styles%', (css && css.code ? `<style>${css.code}</style>` : ''));\n\n\t\t\t\t\t\tres.end(page);\n\n\t\t\t\t\t\tif (process.send) {\n\t\t\t\t\t\t\tprocess.send({\n\t\t\t\t\t\t\t\t__sapper__: true,\n\t\t\t\t\t\t\t\turl: req.url,\n\t\t\t\t\t\t\t\tmethod: req.method,\n\t\t\t\t\t\t\t\tstatus: 200,\n\t\t\t\t\t\t\t\ttype: 'text/html',\n\t\t\t\t\t\t\t\tbody: page\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\telse {\n\t\t\t\t\tconst method = req.method.toLowerCase();\n\t\t\t\t\t// 'delete' cannot be exported from a module because it is a keyword,\n\t\t\t\t\t// so check for 'del' instead\n\t\t\t\t\tconst method_export = method === 'delete' ? 'del' : method;\n\t\t\t\t\tconst handle_method = mod[method_export];\n\t\t\t\t\tif (handle_method) {\n\t\t\t\t\t\tif (process.env.SAPPER_EXPORT) {\n\t\t\t\t\t\t\tconst { write, end, setHeader } = res;\n\t\t\t\t\t\t\tconst chunks: any[] = [];\n\t\t\t\t\t\t\tconst headers: Record<string, string> = {};\n\n\t\t\t\t\t\t\t// intercept data so that it can be exported\n\t\t\t\t\t\t\tres.write = function(chunk: any) {\n\t\t\t\t\t\t\t\tchunks.push(new Buffer(chunk));\n\t\t\t\t\t\t\t\twrite.apply(res, arguments);\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tres.setHeader = function(name: string, value: string) {\n\t\t\t\t\t\t\t\theaders[name.toLowerCase()] = value;\n\t\t\t\t\t\t\t\tsetHeader.apply(res, arguments);\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tres.end = function(chunk?: any) {\n\t\t\t\t\t\t\t\tif (chunk) chunks.push(new Buffer(chunk));\n\t\t\t\t\t\t\t\tend.apply(res, arguments);\n\n\t\t\t\t\t\t\t\tprocess.send({\n\t\t\t\t\t\t\t\t\t__sapper__: true,\n\t\t\t\t\t\t\t\t\turl: req.url,\n\t\t\t\t\t\t\t\t\tmethod: req.method,\n\t\t\t\t\t\t\t\t\tstatus: res.statusCode,\n\t\t\t\t\t\t\t\t\ttype: headers['content-type'],\n\t\t\t\t\t\t\t\t\tbody: Buffer.concat(chunks).toString()\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst handle_bad_result = (err?: Error) => {\n\t\t\t\t\t\t\tif (err) {\n\t\t\t\t\t\t\t\tconsole.error(err.stack);\n\t\t\t\t\t\t\t\tres.statusCode = 500;\n\t\t\t\t\t\t\t\tres.end(err.message);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tprocess.nextTick(next);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\thandle_method(req, res, handle_bad_result);\n\t\t\t\t\t\t} catch (err) {\n\t\t\t\t\t\t\thandle_bad_result(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// no matching handler for method\n\t\t\t\t\t\tprocess.nextTick(next);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\thandle_error(req, res, 500, error);\n\t\t\t}\n\t\t}\n\n\t\tnext();\n\t}\n\n\tconst not_found_route = routes.find((route: RouteObject) => route.error === '4xx');\n\tconst error_route = routes.find((route: RouteObject) => route.error === '5xx');\n\n\tfunction handle_error(req: Req, res: ServerResponse, statusCode: number, message: Error | string) {\n\t\tres.statusCode = statusCode;\n\t\tres.setHeader('Content-Type', 'text/html');\n\n\t\tconst error = message instanceof Error ? message : new Error(message);\n\n\t\tconst not_found = statusCode >= 400 && statusCode < 500;\n\n\t\tconst route = not_found\n\t\t\t? not_found_route\n\t\t\t: error_route;\n\n\t\tfunction render_page({ head, css, html }) {\n\t\t\tconst page = template()\n\t\t\t\t.replace('%sapper.base%', `<base href=\"${req.baseUrl}/\">`)\n\t\t\t\t.replace('%sapper.scripts%', `<script>__SAPPER__={baseUrl: \"${req.baseUrl}\"}</script><script src='${req.baseUrl}/client/${chunks.main}'></script>`)\n\t\t\t\t.replace('%sapper.html%', html)\n\t\t\t\t.replace('%sapper.head%', `<noscript id='sapper-head-start'></noscript>${head}<noscript id='sapper-head-end'></noscript>`)\n\t\t\t\t.replace('%sapper.styles%', (css && css.code ? `<style>${css.code}</style>` : ''));\n\n\t\t\tres.end(page);\n\t\t}\n\n\t\tfunction handle_notfound() {\n\t\t\tconst title: string = not_found\n\t\t\t\t? 'Not found'\n\t\t\t\t: `Internal server error: ${error.message}`;\n\n\t\t\trender_page({ head: '', css: null, html: title });\n\t\t}\n\n\t\tif (route) {\n\t\t\tconst handlers = route.handlers[Symbol.iterator]();\n\n\t\t\tfunction next() {\n\t\t\t\tconst { value: handler, done } = handlers.next();\n\n\t\t\t\tif (done) {\n\t\t\t\t\thandle_notfound();\n\t\t\t\t} else if (handler.type === 'page') {\n\t\t\t\t\trender_page(handler.module.render({\n\t\t\t\t\t\tstatus: statusCode,\n\t\t\t\t\t\terror\n\t\t\t\t\t}, {\n\t\t\t\t\t\tstore: store_getter && store_getter(req)\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\tconst handle_method = mod[method_export];\n\t\t\t\t\tif (handle_method) {\n\t\t\t\t\t\thandle_method(req, res, next);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnext();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tnext();\n\t\t} else {\n\t\t\thandle_notfound();\n\t\t}\n\t}\n\n\treturn function find_route(req: Req, res: ServerResponse) {\n\t\tfor (const route of routes) {\n\t\t\tif (!route.error && route.pattern.test(req.path)) return handle_route(route, req, res);\n\t\t}\n\n\t\thandle_error(req, res, 404, 'Not found');\n\t};\n}\n\nfunction compose_handlers(handlers: Handler[]) {\n\treturn (req: Req, res: ServerResponse, next: () => void) => {\n\t\tlet i = 0;\n\t\tfunction go() {\n\t\t\tconst handler = handlers[i];\n\n\t\t\tif (handler) {\n\t\t\t\thandler(req, res, () => {\n\t\t\t\t\ti += 1;\n\t\t\t\t\tgo();\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tnext();\n\t\t\t}\n\t\t}\n\n\t\tgo();\n\t};\n}\n\nfunction read_json(file: string) {\n\treturn JSON.parse(fs.readFileSync(file, 'utf-8'));\n}\n\nfunction try_serialize(data: any) {\n\ttry {\n\t\treturn devalue(data);\n\t} catch (err) {\n\t\treturn null;\n\t}\n}\n"],"names":["locations","fs.readFileSync","path.join","fs.existsSync","dev","path.resolve","url","URL","cookie"],"mappings":"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"}